# firmorat
Proyecto Integrador

En el archivo application.properties (src/main/resources) se puede modificar el puerto que se desea usar, así como configurar el nombre de la bd
y las credenciales de acceso a MySQL

Se crearon los usuarios gyauri y smendozal con permisos de Gestor y Firmante respectivamente.

GESTOR
gyaurib
admin99

FIRMANTE
smendozal
test99

La ruta para acceder es la siguiente:
http://localhost:8080/login 

/*
SCRIPT BD
-- MySQL Script generated by MySQL Workbench
-- Fri Feb  5 19:23:06 2021
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering


SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema db_firma_digital
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `db_firma_digital` ;

-- -----------------------------------------------------
-- Schema db_firma_digital
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `db_firma_digital` DEFAULT CHARACTER SET utf8 ;
USE `db_firma_digital` ;


-- -----------------------------------------------------
-- Table `db_firma_digital`.`cliente`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_firma_digital`.`cliente` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `ruc` CHAR(11) NULL,
  `razon_social` VARCHAR(45) NULL,
  `direccion_fiscal` VARCHAR(45) NULL,
  `email` VARCHAR(45) NULL,
  `codigo_postal` INT NULL,
  `saldo_firmas` INT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_firma_digital`.`bolsa de firmas`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_firma_digital`.`planes` (
  `idPlanes` INT NOT NULL AUTO_INCREMENT,
  `descripcion` VARCHAR(45) NULL,
  `vigencia` DATE NULL,
  `cantidad` INT NULL,
  `precio_venta` DOUBLE NULL,
  `igv` DOUBLE NULL,
  PRIMARY KEY (`idPlanes`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `db_firma_digital`.`rol`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_firma_digital`.`rol` (
  `id_rol` INT NOT NULL AUTO_INCREMENT,
  `descripcion` VARCHAR(45) NULL,
  PRIMARY KEY (`id_rol`))
ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `db_firma_digital`.`certificado digital`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_firma_digital`.`certificado_digital` (
  `codigo` INT NOT NULL AUTO_INCREMENT,
  `fecha_registro` DATE NULL,
  PRIMARY KEY (`codigo`))
ENGINE = InnoDB;

-- -----------------------------------------------------
-- Table `db_firma_digital`.`trabajador`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_firma_digital`.`trabajador` (
  `dni_trabajador` char(8) NOT NULL,
  `nombres` VARCHAR(45) NULL,
  `apellidos` VARCHAR(45) NULL,
  `correo` VARCHAR(45) NULL,
  `fecha_nac` DATE NULL,
  `direccion` VARCHAR(45) NULL,
  `id_rol` INT NOT NULL, 
  `cod_certificado` INT NULL,
  `id_cliente` INT NULL,
  PRIMARY KEY (`dni_trabajador`),
  CONSTRAINT `fk_trabajador_rol1`
    FOREIGN KEY (`id_rol`)
    REFERENCES `db_firma_digital`.`rol` (`id_rol`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
    CONSTRAINT `fk_trabajador_certificado1`
    FOREIGN KEY (`cod_certificado`)
    REFERENCES `db_firma_digital`.`certificado_digital` (`codigo`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
    CONSTRAINT `fk_trabajador_cliente1`
    FOREIGN KEY (`id_cliente`)
    REFERENCES `db_firma_digital`.`cliente` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_trabajador_rol1_idx` ON `db_firma_digital`.`trabajador` (`id_rol` ASC);


-- -----------------------------------------------------
-- Table `db_firma_digital`.`documento`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_firma_digital`.`documento` (
  `cod_documento` INT NOT NULL AUTO_INCREMENT,
  `nombre` VARCHAR(45) NOT NULL,
  `descripcion` VARCHAR(45) NOT NULL, 
  `dni_carga` char(8) NOT NULL,
  `doc_cargado` VARCHAR(45) NULL,  
  `fecha_carga` DATE NULL,  
  `dni_firma` char(8) NOT NULL,  
  `doc_firmado` VARCHAR(45) NULL,  
  `fecha_firma` DATE NULL,    
  PRIMARY KEY (`cod_documento`),
  CONSTRAINT `fk_documento_trabajador_carga`
    FOREIGN KEY (`dni_carga`)
    REFERENCES `db_firma_digital`.`trabajador` (`dni_trabajador`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
    CONSTRAINT `fk_documento_trabajador_firma`
    FOREIGN KEY (`dni_firma`)
    REFERENCES `db_firma_digital`.`trabajador` (`dni_trabajador`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_documento_trabajador_idx` ON `db_firma_digital`.`documento` (`dni_carga` ASC);

-- -----------------------------------------------------
-- Table `db_firma_digital`.`Venta`
-- -----------------------------------------------------
CREATE TABLE IF NOT EXISTS `db_firma_digital`.`Venta de Firmas` (
  `codigo_venta` INT NOT NULL AUTO_INCREMENT,
  `descripcion` VARCHAR(45) NULL,
  `precio_venta` DOUBLE NULL,
  `igv` DECIMAL NULL,
  `fecha_venta` DATE NULL,
  `Cliente_id` INT NOT NULL,
  `Planes_idPlanes` INT NOT NULL,
  PRIMARY KEY (`codigo_venta`),
  CONSTRAINT `fk_Venta de Firmas_Cliente`
    FOREIGN KEY (`Cliente_id`)
    REFERENCES `db_firma_digital`.`Cliente` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Venta de Firmas_Planes1`
    FOREIGN KEY (`Planes_idPlanes`)
    REFERENCES `db_firma_digital`.`Planes` (`idPlanes`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

CREATE INDEX `fk_Venta de Firmas_Cliente_idx` ON `db_firma_digital`.`Venta de Firmas` (`Cliente_id` ASC);

CREATE INDEX `fk_Venta de Firmas_Planes1_idx` ON `db_firma_digital`.`Venta de Firmas` (`Planes_idPlanes` ASC);

-- -----------------------------------------------------
-- Table `db_firma_digital`.`usuario`
-- -----------------------------------------------------

CREATE TABLE IF NOT EXISTS `db_firma_digital`.`usuario` (
	`id_usuario` INT NOT NULL AUTO_INCREMENT,
    `username` VARCHAR(25) NOT NULL,
    `password` VARCHAR(100) NOT NULL,
    PRIMARY KEY (`id_usuario`))
ENGINE = InnoDB;

CREATE TABLE IF NOT EXISTS `db_firma_digital`.`usuario_trabajador`(
	`id_usu_tra` INT NOT NULL AUTO_INCREMENT,
    `id_usuario` INT NOT NULL,
    `dni_trabajador` char(8) NOT NULL,
    PRIMARY KEY (`id_usu_tra`),
    CONSTRAINT `fk_usutra_usuario`
    FOREIGN KEY (`id_usuario`)
    REFERENCES `db_firma_digital`.`usuario` (`id_usuario`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_usutra_trabajador`
    FOREIGN KEY (`dni_trabajador`)
    REFERENCES `db_firma_digital`.`trabajador` (`dni_trabajador`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- DATOS PARAMETRICOS
-- -----------------------------------------------------
  
INSERT INTO CLIENTE (RUC,RAZON_SOCIAL,DIRECCION_FISCAL)
values ('20545739284','CIBERTEC PERU S.A.C.','Av. Uruguay Nro. 514 Cercado de Lima');

insert into certificado_digital (fecha_registro)
values (curdate());

insert into rol (descripcion)
values ("ROLE_FIRMANTE");
insert into rol (descripcion)
values ("ROLE_GESTOR");


INSERT INTO TRABAJADOR (dni_trabajador,nombres,apellidos, correo,direccion,id_rol,cod_certificado,id_cliente)
values ('73114622','Gustavo','Yauri Barrantes','tripcr6@gmail.com','Jirón Francisco Bolognesi 875',2,1,1);

INSERT INTO TRABAJADOR (dni_trabajador,nombres,apellidos, correo,direccion,id_rol,cod_certificado,id_cliente)
values ('65847410','Susana','Mendoza Lama','ridddg_c@gmail.com','Avenida La Molina 5623',1,1,1);

insert into usuario(username,password) 
values ('gyaurib','$2a$10$Pd3VutNykkTvbG8PZ2XRd.kUMQ7ozVoey43iZ7K61/oxSxgbnT0xa');

insert into usuario(username,password) 
values ('smendozal','$2a$10$ryL8PsAUt5XLPr4MQafeBODF5bUcmlrruRSaAizCWVMi.3WNz2crm');

insert into usuario_trabajador (id_usuario,dni_trabajador)
values (1,'73114622');

insert into usuario_trabajador (id_usuario,dni_trabajador)
values (2,'65847410');

*/
